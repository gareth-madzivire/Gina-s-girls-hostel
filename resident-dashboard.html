<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gina's Hostel - Resident Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .welcome-section h1 {
            color: #333;
            margin-bottom: 5px;
        }

        .welcome-section p {
            color: #666;
        }

        .emergency-btn {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            transition: transform 0.3s;
        }

        .emergency-btn:hover {
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .profile-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 30px;
        }

        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 15px;
            border: none;
            background: #f7fafc;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            color: #4a5568;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .payment-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .payment-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .payment-amount {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }

        .payment-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-paid {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-pending {
            background: #fed7d7;
            color: #742a2a;
        }

        .payment-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item label {
            display: block;
            color: #718096;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .detail-item span {
            color: #2d3748;
            font-weight: 500;
        }

        .payment-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .issue-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .issue-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }

        .issue-type {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .type-maintenance {
            background: #bee3f8;
            color: #2c5282;
        }

        .type-security {
            background: #fed7d7;
            color: #742a2a;
        }

        .type-cleanliness {
            background: #c6f6d5;
            color: #22543d;
        }

        .issue-description {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .issue-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            color: #2d3748;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
        }

        .close-modal:hover {
            color: #2d3748;
        }

        .modal-footer {
            margin-top: 30px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .rules-section {
            margin-bottom: 30px;
        }

        .rules-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rules-list {
            list-style: none;
        }

        .rules-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rules-list li:before {
            content: "‚Ä¢";
            color: #667eea;
            font-size: 20px;
        }

        .notification-badge {
            background: #f56565;
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 12px;
            margin-left: 10px;
        }

        .logout-btn {
            background: #fed7d7;
            color: #742a2a;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #feb2b2;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #4a5568;
        }

        .payment-progress {
            margin-top: 15px;
        }

        .progress-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            transition: width 0.3s;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 14px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="welcome-section">
                <h1>Welcome back, <span id="residentName">Resident</span>!</h1>
                <p>Last login: <span id="lastLogin">Loading...</span></p>
            </div>
            
            <div>
                <button onclick="window.open('tel:+263711391414')" class="emergency-btn">
                    <span>üö®</span> Emergency Call
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="profile-info">
                    <div class="profile-icon">
                        <span>üë§</span>
                    </div>
                    <h2 id="sidebarName">Resident Name</h2>
                    <p>Room: <span id="sidebarRoom">Loading...</span></p>
                    <p>Status: <span style="color: #48bb78;">Active</span></p>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showSection('dashboard')">
                        <span>üìä</span> Dashboard
                    </button>
                    <button class="nav-btn" onclick="showSection('payments')">
                        <span>üí∞</span> My Payments
                    </button>
                    <button class="nav-btn" onclick="showSection('issues')">
                        <span>‚ö†Ô∏è</span> Report Issues
                    </button>
                    <button class="nav-btn" onclick="showSection('rules')">
                        <span>üìã</span> House Rules
                    </button>
                    <button class="nav-btn" onclick="showSection('checkout')">
                        <span>üö™</span> Check-out Request
                    </button>
                    <button class="nav-btn" onclick="showSection('profile')">
                        <span>üë§</span> My Profile
                    </button>
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="color: #4a5568; margin-bottom: 15px;">Emergency Contacts</h3>
                    <div style="background: #fed7d7; padding: 15px; border-radius: 10px;">
                        <p style="color: #742a2a; margin-bottom: 5px;"><strong>Caretaker Garry</strong></p>
                        <p style="color: #742a2a; font-size: 14px;">üìû +263 71 139 1414</p>
                        <p style="color: #742a2a; font-size: 14px;">üí¨ +263 77 130 8790 (WhatsApp)</p>
                    </div>
                </div>

                <button onclick="logout()" class="logout-btn" style="width: 100%; margin-top: 20px;">
                    üö™ Logout
                </button>
            </div>

            <div class="content-area">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section active">
                    <h2 style="color: #2d3748; margin-bottom: 20px;">Dashboard Overview</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Current Month Paid</h3>
                            <div class="number" id="currentMonthPaid">$0</div>
                            <p id="paymentStatusText">Status: Loading...</p>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Days Stayed</h3>
                            <div class="number" id="daysStayed">0</div>
                            <p>Check-in: <span id="checkinDate">Loading...</span></p>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Open Issues</h3>
                            <div class="number" id="openIssues">0</div>
                            <p id="issuesStatusText">All resolved</p>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Monthly Rent</h3>
                            <div class="number" id="monthlyRent">$0</div>
                            <p>Due: <span id="balanceDue">$0</span></p>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3 style="color: #2d3748; margin-bottom: 20px;">Quick Actions</h3>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button onclick="showSection('payments')" class="btn btn-primary">
                                üí∞ Make Payment
                            </button>
                            <button onclick="showReportIssueModal()" class="btn btn-secondary">
                                ‚ö†Ô∏è Report Issue
                            </button>
                            <button onclick="showSection('checkout')" class="btn btn-secondary">
                                üö™ Request Check-out
                            </button>
                            <button onclick="showSection('rules')" class="btn btn-secondary">
                                üìã View Rules
                            </button>
                        </div>
                    </div>

                    <div style="margin-top: 40px;">
                        <h3 style="color: #2d3748; margin-bottom: 20px;">Recent Activity</h3>
                        <div id="recentActivity">
                            <!-- Activity will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Payments Section -->
                <div id="payments-section" class="section">
                    <h2 style="color: #2d3748; margin-bottom: 20px;">My Payments</h2>
                    
                    <div style="background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: #2d3748;">Current Month</h3>
                                <p style="color: #718096;" id="currentMonthLabel">December 2024</p>
                            </div>
                            <div style="text-align: right;">
                                <div class="payment-amount" id="monthlyRentDisplay">$0</div>
                                <span class="payment-status" id="currentMonthStatus">Not Paid</span>
                            </div>
                        </div>
                        
                        <div class="payment-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="paymentProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span>Paid: <span id="paidAmount">$0</span></span>
                                <span>Remaining: <span id="remainingAmount">$0</span></span>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: #2d3748; margin-bottom: 20px;">Payment History</h3>
                    <div id="paymentHistory">
                        <!-- Payments will be loaded here -->
                    </div>
                    
                    <button onclick="downloadPaymentHistory()" class="btn btn-primary" style="margin-top: 20px;">
                        üì• Download Payment History
                    </button>
                </div>

                <!-- Issues Section -->
                <div id="issues-section" class="section">
                    <h2 style="color: #2d3748; margin-bottom: 20px;">Report Issues</h2>
                    
                    <div style="background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="color: #742a2a;">Need to report an issue?</h3>
                                <p style="color: #742a2a;">We're here to help with any maintenance or concerns</p>
                            </div>
                            <button onclick="showReportIssueModal()" class="btn" style="background: white; color: #742a2a;">
                                ‚ö†Ô∏è Report New Issue
                            </button>
                        </div>
                    </div>

                    <h3 style="color: #2d3748; margin-bottom: 20px;">My Reported Issues</h3>
                    <div id="reportedIssues">
                        <!-- Issues will be loaded here -->
                    </div>
                </div>

                <!-- House Rules Section -->
                <div id="rules-section" class="section">
                    <h2 style="color: #2d3748; margin-bottom: 20px;">House Rules & Policies</h2>
                    
                    <div class="rules-section">
                        <h3>üè† Security Rules</h3>
                        <ul class="rules-list">
                            <li>Gates are locked at 8:00 PM sharp. No exceptions.</li>
                            <li>No male visitors are allowed inside the compound at any time.</li>
                            <li>Female visitors must leave by 8:00 PM.</li>
                            <li>Guard dogs are released after curfew hours.</li>
                            <li>All residents must carry their resident ID at all times.</li>
                        </ul>
                    </div>

                    <div class="rules-section">
                        <h3>‚ö° Facility Rules</h3>
                        <ul class="rules-list">
                            <li>Water conservation is mandatory. Report leaks immediately.</li>
                            <li>Do not overload electrical circuits.</li>
                            <li>Keep common areas clean. Dispose of trash properly.</li>
                            <li>Quiet hours: 10:00 PM to 6:00 AM.</li>
                        </ul>
                    </div>

                    <div class="rules-section">
                        <h3>üö® Emergency Procedures</h3>
                        <ul class="rules-list">
                            <li>Emergency Call: +263 71 139 1414</li>
                            <li>Emergency WhatsApp: +263 77 130 8790</li>
                            <li>Know the location of fire extinguishers and emergency exits.</li>
                            <li>First aid kit location: Admin office.</li>
                        </ul>
                    </div>

                    <div style="background: #c6f6d5; padding: 20px; border-radius: 10px; margin-top: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="color: #22543d;">Accept House Rules</h3>
                                <p style="color: #22543d;">By accepting, you agree to abide by all rules and policies</p>
                            </div>
                            <button onclick="acceptRules()" class="btn btn-success" id="acceptRulesBtn">
                                ‚úÖ I Accept All Rules
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Check-out Request Section -->
                <div id="checkout-section" class="section">
                    <h2 style="color: #2d3748; margin-bottom: 20px;">Check-out Request</h2>
                    
                    <div style="background: linear-gradient(135deg, #e9d8fd 0%, #d6bcfa 100%); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3 style="color: #553c9a; margin-bottom: 15px;">Submit Check-out Request</h3>
                        <p style="color: #553c9a; margin-bottom: 20px;">Please submit your check-out request at least 7 days before your intended departure date.</p>
                        
                        <form id="checkoutForm">
                            <div class="form-group">
                                <label for="checkoutDate">Intended Check-out Date *</label>
                                <input type="date" id="checkoutDate" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="checkoutReason">Reason for Leaving</label>
                                <select id="checkoutReason" class="form-control">
                                    <option value="">Select reason</option>
                                    <option value="Studies Complete">Studies Complete</option>
                                    <option value="Transfer to Other Hostel">Transfer to Other Hostel</option>
                                    <option value="Returning Home">Returning Home</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="checkoutNotes">Additional Notes (Optional)</label>
                                <textarea id="checkoutNotes" class="form-control" rows="4"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                üì§ Submit Check-out Request
                            </button>
                        </form>
                    </div>

                    <h3 style="color: #2d3748; margin-bottom: 20px;">Previous Requests</h3>
                    <div id="previousRequests">
                        <!-- Previous requests will be loaded here -->
                    </div>
                </div>

                <!-- Profile Section -->
                <div id="profile-section" class="section">
                    <h2 style="color: #2d3748; margin-bottom: 20px;">My Profile</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; margin-bottom: 30px;">
                        <div>
                            <h3 style="color: #4a5568; margin-bottom: 15px;">Personal Information</h3>
                            <div style="background: #f7fafc; padding: 20px; border-radius: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Full Name</label>
                                    <span id="profileFullName" style="font-size: 18px; font-weight: bold; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Phone Number</label>
                                    <span id="profilePhone" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Email Address</label>
                                    <span id="profileEmail" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Institution</label>
                                    <span id="profileInstitution" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">ID/Passport Number</label>
                                    <span id="profileIdNumber" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: #4a5568; margin-bottom: 15px;">Stay Information</h3>
                            <div style="background: #f7fafc; padding: 20px; border-radius: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Room Number</label>
                                    <span id="profileRoom" style="font-size: 18px; font-weight: bold; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Check-in Date</label>
                                    <span id="profileCheckin" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Stay Duration</label>
                                    <span id="profileStayDuration" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Monthly Rent</label>
                                    <span id="profileMonthlyRent" style="font-size: 16px; color: #2d3748;">Loading...</span>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; color: #718096; font-size: 14px;">Status</label>
                                    <span style="padding: 5px 15px; background: #c6f6d5; color: #22543d; border-radius: 20px; font-size: 14px;">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 style="color: #4a5568; margin-bottom: 15px;">Emergency Contact</h3>
                    <div style="background: #fed7d7; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div>
                                <label style="display: block; color: #742a2a; font-size: 14px;">Emergency Contact Name</label>
                                <span id="profileEmergencyName" style="font-size: 16px; color: #742a2a; font-weight: bold;">Loading...</span>
                            </div>
                            
                            <div>
                                <label style="display: block; color: #742a2a; font-size: 14px;">Emergency Contact Phone</label>
                                <span id="profileEmergencyPhone" style="font-size: 16px; color: #742a2a; font-weight: bold;">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <button onclick="updateProfile()" class="btn btn-primary">
                        ‚úèÔ∏è Update Profile Information
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Issue Modal -->
    <div id="reportIssueModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚ö†Ô∏è Report New Issue</h3>
                <button onclick="hideModal('reportIssueModal')" class="close-modal">√ó</button>
            </div>
            
            <form id="issueForm">
                <div class="form-group">
                    <label for="issueTitle">Issue Title *</label>
                    <input type="text" id="issueTitle" class="form-control" placeholder="Brief description" required>
                </div>
                
                <div class="form-group">
                    <label for="issueType">Issue Type *</label>
                    <select id="issueType" class="form-control" required>
                        <option value="">Select type</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Security">Security</option>
                        <option value="Cleanliness">Cleanliness</option>
                        <option value="Noise">Noise</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="issueLocation">Location *</label>
                    <select id="issueLocation" class="form-control" required>
                        <option value="">Select location</option>
                        <option value="My Room">My Room</option>
                        <option value="Common Area">Common Area</option>
                        <option value="Bathroom">Bathroom</option>
                        <option value="Kitchen">Kitchen</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="issuePriority">Priority *</label>
                    <select id="issuePriority" class="form-control" required>
                        <option value="">Select priority</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Emergency">Emergency</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="issueDescription">Detailed Description *</label>
                    <textarea id="issueDescription" class="form-control" rows="4" required placeholder="Please provide details..."></textarea>
                </div>
                
                <div class="modal-footer">
                    <button type="button" onclick="hideModal('reportIssueModal')" class="btn btn-secondary">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Submit Report
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Profile Modal -->
    <div id="updateProfileModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Update Profile</h3>
                <button onclick="hideModal('updateProfileModal')" class="close-modal">√ó</button>
            </div>
            
            <form id="profileForm">
                <div class="form-group">
                    <label for="updateEmail">Email Address</label>
                    <input type="email" id="updateEmail" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="updateEmergencyName">Emergency Contact Name</label>
                    <input type="text" id="updateEmergencyName" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="updateEmergencyPhone">Emergency Contact Phone</label>
                    <input type="tel" id="updateEmergencyPhone" class="form-control">
                </div>
                
                <div class="modal-footer">
                    <button type="button" onclick="hideModal('updateProfileModal')" class="btn btn-secondary">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Update Profile
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal-overlay">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">üßæ Payment Receipt</h3>
                <button onclick="hideModal('receiptModal')" class="close-modal">√ó</button>
            </div>
            
            <div id="receiptContent" style="padding: 20px; background: white; border-radius: 10px; border: 2px solid #e2e8f0;">
                <!-- Receipt content will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button onclick="downloadReceipt()" class="btn btn-success">
                    üì• Download Receipt
                </button>
                <button onclick="hideModal('receiptModal')" class="btn btn-secondary">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize resident data
        let currentResident = null;
        let paymentsData = [];
        let issuesData = [];
        let checkoutRequests = [];

        // Check if resident is logged in
        window.onload = function() {
            checkLogin();
            loadResidentData();
            setupEventListeners();
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000); // Update time every minute
        };

        function checkLogin() {
            const residentData = localStorage.getItem('currentResident');
            if (!residentData) {
                window.location.href = 'resident-login.html';
                return;
            }
            currentResident = JSON.parse(residentData);
        }

        function loadResidentData() {
            if (!currentResident) return;

            // Load data from localStorage
            const allResidents = JSON.parse(localStorage.getItem('approvedResidents') || '[]');
            const resident = allResidents.find(r => r.id === currentResident.id);
            
            if (resident) {
                updateUI(resident);
                loadPayments();
                loadIssues();
                loadCheckoutRequests();
                loadRecentActivity();
                updatePaymentProgress();
            }
        }

        function updateUI(resident) {
            // Update dashboard
            document.getElementById('residentName').textContent = resident.firstName || 'Resident';
            document.getElementById('sidebarName').textContent = resident.fullName || 'Resident';
            document.getElementById('sidebarRoom').textContent = resident.roomAssigned || 'Not assigned';
            document.getElementById('profileFullName').textContent = resident.fullName || 'Not available';
            document.getElementById('profilePhone').textContent = resident.phone || 'Not available';
            document.getElementById('profileEmail').textContent = resident.email || 'Not available';
            document.getElementById('profileInstitution').textContent = resident.institution || 'Not available';
            document.getElementById('profileIdNumber').textContent = resident.idNumber || 'Not available';
            document.getElementById('profileRoom').textContent = resident.roomAssigned || 'Not assigned';
            document.getElementById('profileEmergencyName').textContent = resident.emergencyName || 'Not available';
            document.getElementById('profileEmergencyPhone').textContent = resident.emergencyPhone || 'Not available';
            
            // Calculate stay duration
            if (resident.checkinDate) {
                const checkin = new Date(resident.checkinDate);
                const today = new Date();
                const daysStayed = Math.floor((today - checkin) / (1000 * 60 * 60 * 24));
                document.getElementById('daysStayed').textContent = daysStayed;
                document.getElementById('checkinDate').textContent = checkin.toLocaleDateString();
                document.getElementById('profileCheckin').textContent = checkin.toLocaleDateString();
                document.getElementById('profileStayDuration').textContent = daysStayed + ' days';
            }
            
            // Update payment info
            const monthlyRent = parseFloat(resident.monthlyRent || 0);
            document.getElementById('monthlyRent').textContent = '$' + monthlyRent.toFixed(2);
            document.getElementById('profileMonthlyRent').textContent = '$' + monthlyRent.toFixed(2);
            document.getElementById('monthlyRentDisplay').textContent = '$' + monthlyRent.toFixed(2);
            
            // Update last login
            const lastLogin = currentResident.loginTime ? new Date(currentResident.loginTime) : new Date();
            document.getElementById('lastLogin').textContent = lastLogin.toLocaleString();
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId + '-section').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load section-specific data
            switch(sectionId) {
                case 'payments':
                    loadPayments();
                    break;
                case 'issues':
                    loadIssues();
                    break;
                case 'rules':
                    loadRules();
                    break;
                case 'checkout':
                    loadCheckoutRequests();
                    break;
                case 'profile':
                    loadProfile();
                    break;
            }
        }

        function loadPayments() {
            if (!currentResident) return;
            
            const payments = JSON.parse(localStorage.getItem('payments') || '[]');
            const residentPayments = payments.filter(p => p.residentId === currentResident.id);
            paymentsData = residentPayments;
            
            const container = document.getElementById('paymentHistory');
            if (residentPayments.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #718096;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üí∞</div>
                        <h3>No Payment History</h3>
                        <p>No payments have been recorded yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            residentPayments.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = residentPayments.map(payment => `
                <div class="payment-card">
                    <div class="payment-header">
                        <div>
                            <h4 style="color: #2d3748; margin-bottom: 5px;">Payment for ${payment.month || 'N/A'}</h4>
                            <p style="color: #718096; font-size: 14px;">${new Date(payment.date).toLocaleDateString()}</p>
                        </div>
                        <div>
                            <div class="payment-amount">$${parseFloat(payment.amount).toFixed(2)}</div>
                            <span class="payment-status status-paid">Paid</span>
                        </div>
                    </div>
                    
                    <div class="payment-details">
                        <div class="detail-item">
                            <label>Payment Method</label>
                            <span>${payment.method || 'Cash'}</span>
                        </div>
                        <div class="detail-item">
                            <label>Transaction ID</label>
                            <span>${payment.id || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <label>Received By</label>
                            <span>${payment.recordedBy || 'Admin'}</span>
                        </div>
                    </div>
                    
                    ${payment.notes ? `
                        <div style="margin-top: 10px;">
                            <label style="color: #718096; font-size: 14px;">Notes:</label>
                            <p style="color: #4a5568;">${payment.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div class="payment-actions">
                        <button onclick="viewReceipt('${payment.id}')" class="btn btn-primary">
                            üëÅÔ∏è View Receipt
                        </button>
                        <button onclick="downloadReceipt('${payment.id}')" class="btn btn-secondary">
                            üì• Download
                        </button>
                    </div>
                </div>
            `).join('');
            
            updatePaymentProgress();
        }

        function updatePaymentProgress() {
            if (!currentResident) return;
            
            const residents = JSON.parse(localStorage.getItem('approvedResidents') || '[]');
            const resident = residents.find(r => r.id === currentResident.id);
            if (!resident) return;
            
            const monthlyRent = parseFloat(resident.monthlyRent || 0);
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            
            const payments = JSON.parse(localStorage.getItem('payments') || '[]');
            const currentMonthPayments = payments.filter(p => 
                p.residentId === currentResident.id &&
                new Date(p.date).getMonth() + 1 === currentMonth &&
                new Date(p.date).getFullYear() === currentYear
            );
            
            let totalPaid = 0;
            currentMonthPayments.forEach(p => {
                totalPaid += parseFloat(p.amount || 0);
            });
            
            const progress = monthlyRent > 0 ? Math.min(100, (totalPaid / monthlyRent) * 100) : 0;
            
            document.getElementById('paymentProgress').style.width = progress + '%';
            document.getElementById('currentMonthPaid').textContent = '$' + totalPaid.toFixed(2);
            document.getElementById('paidAmount').textContent = '$' + totalPaid.toFixed(2);
            document.getElementById('remainingAmount').textContent = '$' + Math.max(0, monthlyRent - totalPaid).toFixed(2);
            document.getElementById('balanceDue').textContent = '$' + Math.max(0, monthlyRent - totalPaid).toFixed(2);
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonthLabel').textContent = `${monthNames[currentMonth - 1]} ${currentYear}`;
            
            const statusElement = document.getElementById('currentMonthStatus');
            if (totalPaid >= monthlyRent) {
                statusElement.textContent = 'Paid';
                statusElement.className = 'payment-status status-paid';
                document.getElementById('paymentStatusText').textContent = 'Status: Fully Paid';
            } else if (totalPaid > 0) {
                statusElement.textContent = 'Partial';
                statusElement.className = 'payment-status status-pending';
                document.getElementById('paymentStatusText').textContent = `Status: Partial ($${Math.max(0, monthlyRent - totalPaid).toFixed(2)} due)`;
            } else {
                statusElement.textContent = 'Not Paid';
                statusElement.className = 'payment-status status-pending';
                document.getElementById('paymentStatusText').textContent = `Status: Due ($${monthlyRent.toFixed(2)} due)`;
            }
        }

        function loadIssues() {
            if (!currentResident) return;
            
            const issues = JSON.parse(localStorage.getItem('reportedIssues') || '[]');
            const residentIssues = issues.filter(i => i.reportedBy === currentResident.id);
            issuesData = residentIssues;
            
            const container = document.getElementById('reportedIssues');
            if (residentIssues.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #718096;">
                        <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                        <h3>No Issues Reported</h3>
                        <p>You haven't reported any issues yet.</p>
                        <button onclick="showReportIssueModal()" class="btn btn-primary" style="margin-top: 20px;">
                            ‚ö†Ô∏è Report First Issue
                        </button>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            residentIssues.sort((a, b) => new Date(b.reportedAt) - new Date(a.reportedAt));
            
            container.innerHTML = residentIssues.map(issue => `
                <div class="issue-card">
                    <div class="issue-header">
                        <div class="issue-title">${issue.title}</div>
                        <span class="issue-type type-${issue.type?.toLowerCase() || 'maintenance'}">
                            ${issue.type || 'Maintenance'}
                        </span>
                    </div>
                    
                    <div class="issue-description">
                        ${issue.description}
                    </div>
                    
                    <div class="issue-footer">
                        <div style="color: #718096; font-size: 14px;">
                            Reported: ${new Date(issue.reportedAt).toLocaleDateString()} | 
                            Location: ${issue.location} | 
                            Priority: ${issue.priority}
                        </div>
                        <div>
                            <span style="padding: 5px 15px; border-radius: 20px; font-size: 14px; 
                                ${issue.status === 'open' ? 'background: #fed7d7; color: #742a2a;' : 
                                  issue.status === 'resolved' ? 'background: #c6f6d5; color: #22543d;' : 
                                  'background: #e9d8fd; color: #553c9a;'}">
                                ${issue.status || 'Open'}
                            </span>
                        </div>
                    </div>
                    
                    ${issue.adminResponse ? `
                        <div style="margin-top: 15px; padding: 15px; background: #e9d8fd; border-radius: 8px;">
                            <strong style="color: #553c9a;">Admin Response:</strong>
                            <p style="color: #553c9a; margin-top: 5px;">${issue.adminResponse}</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            // Update open issues count
            const openIssues = residentIssues.filter(i => i.status === 'open').length;
            document.getElementById('openIssues').textContent = openIssues;
            document.getElementById('issuesStatusText').textContent = openIssues > 0 ? 
                `${openIssues} open issue(s)` : 'All issues resolved';
        }

        function loadRules() {
            const accepted = localStorage.getItem('rulesAccepted_' + currentResident.id);
            const acceptBtn = document.getElementById('acceptRulesBtn');
            
            if (accepted === 'true') {
                acceptBtn.disabled = true;
                acceptBtn.textContent = '‚úÖ Rules Accepted';
                acceptBtn.style.background = '#c6f6d5';
                acceptBtn.style.color = '#22543d';
            }
        }

        function loadCheckoutRequests() {
            if (!currentResident) return;
            
            const requests = JSON.parse(localStorage.getItem('checkoutRequests') || '[]');
            const residentRequests = requests.filter(r => r.residentId === currentResident.id);
            checkoutRequests = residentRequests;
            
            const container = document.getElementById('previousRequests');
            if (residentRequests.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #718096;">
                        <p>No previous check-out requests</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = residentRequests.map(request => `
                <div style="background: #f7fafc; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div>
                            <strong style="color: #2d3748;">Check-out Request</strong>
                            <p style="color: #718096; font-size: 14px; margin-top: 5px;">
                                Requested: ${new Date(request.requestedAt).toLocaleDateString()}
                            </p>
                        </div>
                        <span style="padding: 5px 15px; border-radius: 20px; font-size: 14px;
                            ${request.status === 'approved' ? 'background: #c6f6d5; color: #22543d;' : 
                              request.status === 'rejected' ? 'background: #fed7d7; color: #742a2a;' : 
                              'background: #e9d8fd; color: #553c9a;'}">
                            ${request.status || 'Pending'}
                        </span>
                    </div>
                    
                    <div style="color: #4a5568; margin-top: 10px;">
                        <p><strong>Intended Date:</strong> ${new Date(request.checkoutDate).toLocaleDateString()}</p>
                        <p><strong>Reason:</strong> ${request.reason || 'Not specified'}</p>
                        ${request.notes ? `<p><strong>Notes:</strong> ${request.notes}</p>` : ''}
                    </div>
                    
                    ${request.adminResponse ? `
                        <div style="margin-top: 10px; padding: 10px; background: #e9d8fd; border-radius: 8px;">
                            <strong style="color: #553c9a;">Admin Response:</strong>
                            <p style="color: #553c9a; margin-top: 5px;">${request.adminResponse}</p>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            const activities = [];
            
            // Add payment activities
            if (paymentsData.length > 0) {
                paymentsData.slice(0, 3).forEach(payment => {
                    activities.push({
                        type: 'payment',
                        text: `Payment: $${parseFloat(payment.amount).toFixed(2)}`,
                        date: payment.date,
                        icon: 'üí∞'
                    });
                });
            }
            
            // Add issue activities
            if (issuesData.length > 0) {
                issuesData.slice(0, 3).forEach(issue => {
                    activities.push({
                        type: 'issue',
                        text: `Issue: ${issue.title}`,
                        date: issue.reportedAt,
                        icon: '‚ö†Ô∏è'
                    });
                });
            }
            
            // Sort by date
            activities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #718096;">
                        <p>No recent activity</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activities.map(activity => `
                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; 
                     border-bottom: 1px solid #e2e8f0;">
                    <div style="font-size: 24px;">${activity.icon}</div>
                    <div>
                        <p style="color: #2d3748; font-weight: 500;">${activity.text}</p>
                        <p style="color: #718096; font-size: 14px;">
                            ${new Date(activity.date).toLocaleDateString()}
                        </p>
                    </div>
                </div>
            `).join('');
        }

        function loadProfile() {
            // Already loaded in updateUI()
        }

        function showReportIssueModal() {
            document.getElementById('reportIssueModal').classList.add('active');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId === 'reportIssueModal') {
                document.getElementById('issueForm').reset();
            }
        }

        function acceptRules() {
            localStorage.setItem('rulesAccepted_' + currentResident.id, 'true');
            loadRules();
            alert('Thank you for accepting the house rules!');
        }

        function updateProfile() {
            const resident = JSON.parse(localStorage.getItem('approvedResidents') || '[]')
                .find(r => r.id === currentResident.id);
            
            if (resident) {
                document.getElementById('updateEmail').value = resident.email || '';
                document.getElementById('updateEmergencyName').value = resident.emergencyName || '';
                document.getElementById('updateEmergencyPhone').value = resident.emergencyPhone || '';
                showModal('updateProfileModal');
            }
        }

        function viewReceipt(paymentId) {
            const payment = paymentsData.find(p => p.id === paymentId);
            if (!payment) return;
            
            const residents = JSON.parse(localStorage.getItem('approvedResidents') || '[]');
            const resident = residents.find(r => r.id === currentResident.id);
            
            const receiptHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h2 style="color: #2d3748;">Gina's Hostel</h2>
                    <p style="color: #718096;">Payment Receipt</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <strong style="color: #718096; display: block;">Receipt No:</strong>
                        <span>${payment.id}</span>
                    </div>
                    <div>
                        <strong style="color: #718096; display: block;">Date:</strong>
                        <span>${new Date(payment.date).toLocaleDateString()}</span>
                    </div>
                    <div>
                        <strong style="color: #718096; display: block;">Resident:</strong>
                        <span>${resident?.fullName || currentResident.fullName}</span>
                    </div>
                    <div>
                        <strong style="color: #718096; display: block;">Room:</strong>
                        <span>${resident?.roomAssigned || 'N/A'}</span>
                    </div>
                </div>
                
                <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 32px; color: #48bb78;">$${parseFloat(payment.amount).toFixed(2)}</div>
                        <p style="color: #718096;">Payment Amount</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #718096; display: block; margin-bottom: 5px;">Payment Method:</strong>
                    <span>${payment.method || 'Cash'}</span>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #718096; display: block; margin-bottom: 5px;">For Month:</strong>
                    <span>${payment.month || 'N/A'}</span>
                </div>
                
                ${payment.notes ? `
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #718096; display: block; margin-bottom: 5px;">Notes:</strong>
                        <span>${payment.notes}</span>
                    </div>
                ` : ''}
                
                <div style="border-top: 2px solid #e2e8f0; padding-top: 15px;">
                    <strong style="color: #718096; display: block; margin-bottom: 5px;">Received by:</strong>
                    <span>${payment.recordedBy || 'Admin'}</span>
                </div>
            `;
            
            document.getElementById('receiptContent').innerHTML = receiptHTML;
            showModal('receiptModal');
        }

        function downloadReceipt(paymentId) {
            const payment = paymentsData.find(p => p.id === paymentId);
            if (!payment) return;
            
            const residents = JSON.parse(localStorage.getItem('approvedResidents') || '[]');
            const resident = residents.find(r => r.id === currentResident.id);
            
            const receiptText = `
GINA'S HOSTEL - PAYMENT RECEIPT
================================

Receipt No: ${payment.id}
Date: ${new Date(payment.date).toLocaleDateString()}
Time: ${new Date(payment.date).toLocaleTimeString()}

--------------------------------
RESIDENT INFORMATION:
Name: ${resident?.fullName || currentResident.fullName}
Room: ${resident?.roomAssigned || 'N/A'}
Resident ID: ${currentResident.id}

--------------------------------
PAYMENT DETAILS:
Amount: $${parseFloat(payment.amount).toFixed(2)}
Method: ${payment.method || 'Cash'}
For Month: ${payment.month || 'N/A'}
Notes: ${payment.notes || 'None'}

--------------------------------
TRANSACTION INFORMATION:
Transaction ID: ${payment.id}
Received by: ${payment.recordedBy || 'Admin'}

================================
This is an official receipt from Gina's Hostel.
Please keep this for your records.

Generated: ${new Date().toLocaleString()}
            `;
            
            const blob = new Blob([receiptText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `receipt_${payment.id}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Receipt downloaded successfully!');
        }

        function downloadPaymentHistory() {
            if (paymentsData.length === 0) {
                alert('No payment history to download');
                return;
            }
            
            let csvContent = 'Date,Amount,Method,Month,Notes\n';
            
            paymentsData.forEach(payment => {
                const date = new Date(payment.date).toLocaleDateString();
                const amount = parseFloat(payment.amount).toFixed(2);
                const method = payment.method || 'Cash';
                const month = payment.month || '';
                const notes = payment.notes || '';
                
                csvContent += `${date},$${amount},${method},${month},"${notes}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `payment_history_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Payment history downloaded successfully!');
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('en-US', {
                    hour12: true,
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentResident');
                window.location.href = 'resident-login.html';
            }
        }

        function setupEventListeners() {
            // Issue form submission
            document.getElementById('issueForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const issue = {
                    id: 'ISSUE_' + Date.now(),
                    title: document.getElementById('issueTitle').value,
                    type: document.getElementById('issueType').value,
                    location: document.getElementById('issueLocation').value,
                    priority: document.getElementById('issuePriority').value,
                    description: document.getElementById('issueDescription').value,
                    reportedBy: currentResident.id,
                    reportedByName: currentResident.fullName,
                    reportedAt: new Date().toISOString(),
                    status: 'open',
                    room: currentResident.room || 'Not specified'
                };
                
                const issues = JSON.parse(localStorage.getItem('reportedIssues') || '[]');
                issues.push(issue);
                localStorage.setItem('reportedIssues', JSON.stringify(issues));
                
                hideModal('reportIssueModal');
                alert('Issue reported successfully! Admin has been notified.');
                loadIssues();
                loadRecentActivity();
            });

            // Profile form submission
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const residents = JSON.parse(localStorage.getItem('approvedResidents') || '[]');
                const residentIndex = residents.findIndex(r => r.id === currentResident.id);
                
                if (residentIndex !== -1) {
                    residents[residentIndex].email = document.getElementById('updateEmail').value;
                    residents[residentIndex].emergencyName = document.getElementById('updateEmergencyName').value;
                    residents[residentIndex].emergencyPhone = document.getElementById('updateEmergencyPhone').value;
                    
                    localStorage.setItem('approvedResidents', JSON.stringify(residents));
                    
                    hideModal('updateProfileModal');
                    alert('Profile updated successfully!');
                    loadResidentData();
                }
            });

            // Checkout form submission
            document.getElementById('checkoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const checkoutDate = new Date(document.getElementById('checkoutDate').value);
                const today = new Date();
                const minDate = new Date(today);
                minDate.setDate(today.getDate() + 7);
                
                if (checkoutDate < minDate) {
                    alert('Check-out date must be at least 7 days from today.');
                    return;
                }
                
                const request = {
                    id: 'CHECKOUT_' + Date.now(),
                    residentId: currentResident.id,
                    residentName: currentResident.fullName,
                    checkoutDate: checkoutDate.toISOString(),
                    reason: document.getElementById('checkoutReason').value,
                    notes: document.getElementById('checkoutNotes').value,
                    requestedAt: new Date().toISOString(),
                    status: 'pending',
                    room: currentResident.room || 'Not specified'
                };
                
                const requests = JSON.parse(localStorage.getItem('checkoutRequests') || '[]');
                requests.push(request);
                localStorage.setItem('checkoutRequests', JSON.stringify(requests));
                
                alert('Check-out request submitted successfully! Admin will review your request.');
                document.getElementById('checkoutForm').reset();
                loadCheckoutRequests();
            });
        }

        // Add click handlers for nav buttons
        document.addEventListener('DOMContentLoaded', function() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });
    </script>
</body>
</html>
